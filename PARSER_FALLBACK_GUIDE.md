# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–∫–ª—é—á–µ–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–∞ –∫–∞–∫ fallback

## üîÑ –ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –∫–∞–∫ fallback

–ï—Å–ª–∏ MODX API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö.

### 1. –í —Ñ–∞–π–ª–µ `bot/api_server.py`:

#### –í —Ñ—É–Ω–∫—Ü–∏–∏ `setup_api_server()`:
```python
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
await load_products_data_for_api()
```

#### –í —Ñ—É–Ω–∫—Ü–∏–∏ `get_products_for_webapp()`:
```python
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±–ª–æ–∫ FALLBACK:
await load_products_data_for_api()
if products_data:
    if category_key:
        products_in_category = products_data.get(category_key, [])
        if products_in_category:
            return web.json_response(products_in_category, headers={
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Pragma': 'no-cache',
                'Expires': '0'
            })
    else:
        return web.json_response(products_data, headers={
            'Cache-Control': 'no-cache, no-store, must-revalidate',
            'Pragma': 'no-cache',
            'Expires': '0'
        })
```

#### –í —Ñ—É–Ω–∫—Ü–∏–∏ `get_categories_for_webapp()`:
```python
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±–ª–æ–∫ FALLBACK:
await load_products_data_for_api()
if products_data:
    categories_list = []
    for key, products in products_data.items():
        if products: # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
            # –ë–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            category_image = products[0].get('image_url', '')
            categories_list.append({
                "key": key,
                "name": products[0].get('category_name', key), # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
                "image": category_image
            })
    return web.json_response(categories_list, headers={
        'Cache-Control': 'no-cache, no-store, must-revalidate',
        'Pragma': 'no-cache',
        'Expires': '0'
    })
```

### 2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª `data/products_scraped.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞
python parser_job.py

# –ò–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
cp data/products_scraped.json.backup data/products_scraped.json
```

### 3. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–°–Ω–∞—á–∞–ª–∞** –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ MODX API
2. **–ï—Å–ª–∏ MODX API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–∞—Ä—Å–µ—Ä–∞ (JSON —Ñ–∞–π–ª)
3. **–ï—Å–ª–∏ –∏ –ø–∞—Ä—Å–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

### 4. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –µ—Å–ª–∏ MODX API —É–ø–∞–¥–µ—Ç, –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```python
# –í –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ, –∫–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
# "API: –ó–∞–≥—Ä—É–∂–µ–Ω–æ X —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ MODX API" - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MODX API
# "API: –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ data/products_scraped.json" - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö** - –ø–∞—Ä—Å–µ—Ä –∏ MODX API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–∞—Ä—Å–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
3. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é
4. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** - JSON —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ MODX API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```python
# –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
# await load_products_data_for_api()
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: MODX API + –ø–∞—Ä—Å–µ—Ä –∫–∞–∫ fallback
```python
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è fallback
await load_products_data_for_api()
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```python
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å MODX API –≤—ã–∑–æ–≤—ã –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä
```
