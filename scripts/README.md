# üöÄ Cache Management Scripts

–ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à-–≤–µ—Ä—Å–∏—è–º–∏ –≤ Bakery Mini App.

## üìã –û–±–∑–æ—Ä

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π `bump_cache.sh` –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–º –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –Ω–∞ Python —Å bash-–æ–±–µ—Ä—Ç–∫–æ–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

## üîß –°–∫—Ä–∏–ø—Ç—ã

### 1. `cache_manager.py` - –û—Å–Ω–æ–≤–Ω–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫–µ—à–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à-–≤–µ—Ä—Å–∏—è–º–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à-–≤–µ—Ä—Å–∏–π –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö WebApp
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ backup'–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ Rollback –∏–∑ backup'–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (HTML, CSS, JS, SVG)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `sprite.svg`, `main.min.css`, –∏ –≤—Å–µ—Ö SVG –≤ `images/`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –∫–µ—à–∞
python3 scripts/cache_manager.py 1.3.111

# –û–±–Ω–æ–≤–∏—Ç—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º timestamp
python3 scripts/cache_manager.py 1.3.111 --timestamp 1756284000

# –¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
python3 scripts/cache_manager.py 1.3.111 --validate-only

# –ë–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è backup
python3 scripts/cache_manager.py 1.3.111 --no-backup

# Rollback –∏–∑ backup
python3 scripts/cache_manager.py 1.3.111 --rollback
```

**–ß—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:**
- `bot/web_app/index.html` - –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã
- `bot/web_app/style.css` - –≤—Å–µ `url()` —Å—Å—ã–ª–∫–∏
- `bot/web_app/main.min.css` - –≤—Å–µ `url()` —Å—Å—ã–ª–∫–∏
- `bot/web_app/script.js` - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CACHE_VERSION` –∏ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã
- `bot/web_app/sprite.svg` - –ª—é–±—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã
- `bot/web_app/images/*.svg` - –≤—Å–µ SVG —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ images

### 2. `bump_cache.sh` - Bash –æ–±–µ—Ä—Ç–∫–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è bash-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è `cache_manager.py` —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./scripts/bump_cache.sh 1.3.111

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º timestamp
./scripts/bump_cache.sh 1.3.111 1756284000

# –¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è
./scripts/bump_cache.sh 1.3.111 --validate-only

# –ë–µ–∑ backup
./scripts/bump_cache.sh 1.3.111 --no-backup

# Rollback
./scripts/bump_cache.sh 1.3.111 --rollback

# –ü–æ–º–æ—â—å
./scripts/bump_cache.sh --help
```

### 3. `validate_cache.py` - –í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–µ—à–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–µ—à-–≤–µ—Ä—Å–∏–π.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–∏—Å–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–µ—à–∞
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–∞–≤—ã—á–µ–∫
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 scripts/validate_cache.py
```

### 4. `test_cache_manager.py` - –¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 scripts/test_cache_manager.py
```

## üéØ Workflow

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
python3 scripts/validate_cache.py

# 2. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é
./scripts/bump_cache.sh 1.3.111

# 3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å
git add .
git commit -m 'Bump cache to 1.3.111'
git push
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python3 scripts/test_cache_manager.py

# 2. –û–±–Ω–æ–≤–∏—Ç—å —Å backup
./scripts/bump_cache.sh 1.3.111

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
python3 scripts/validate_cache.py

# 4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å
./scripts/bump_cache.sh 1.3.111 --rollback
```

## üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

### HTML —Ñ–∞–π–ª—ã (`index.html`)
- `<script src="...">` —Ç–µ–≥–∏
- `<link href="...">` —Ç–µ–≥–∏  
- `<img src="...">` —Ç–µ–≥–∏

**–ü—Ä–∏–º–µ—Ä:**
```html
<!-- –î–æ -->
<script src="script.js?v=1.3.109&t=1756284000"></script>
<!-- –ü–æ—Å–ª–µ -->
<script src="script.js?v=1.3.111&t=1756912558"></script>
```

### CSS —Ñ–∞–π–ª—ã (`style.css`, `main.min.css`)
- `url()` —Ñ—É–Ω–∫—Ü–∏–∏
- `background-image` —Å–≤–æ–π—Å—Ç–≤–∞

**–ü—Ä–∏–º–µ—Ä:**
```css
/* –î–æ */
background-image: url('images/bg.jpg?v=1.3.109&t=1756284000');
/* –ü–æ—Å–ª–µ */
background-image: url('images/bg.jpg?v=1.3.111&t=1756912558');
```

### JavaScript —Ñ–∞–π–ª—ã (`script.js`)
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `CACHE_VERSION`
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã —Å –ø—É—Ç—è–º–∏ –∫ —Ñ–∞–π–ª–∞–º
- Template literals (backticks)

**–ü—Ä–∏–º–µ—Ä:**
```javascript
// –î–æ
const CACHE_VERSION = '1.3.109';
const img = 'images/icon.svg?v=1.3.109&t=1756284000';
// –ü–æ—Å–ª–µ
const CACHE_VERSION = '1.3.111';
const img = 'images/icon.svg?v=1.3.111&t=1756912558';
```

### SVG —Ñ–∞–π–ª—ã
- –õ—é–±—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- `xlink:href` –∞—Ç—Ä–∏–±—É—Ç—ã

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ Backup

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ Backup'—ã
- –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `backup_cache_[timestamp]/`
- –°–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–ø–∏–∏ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### Rollback
```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É backup'—É
./scripts/bump_cache.sh 1.3.111 --rollback
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `validate_cache.py`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Unclosed quotes"
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
python3 scripts/validate_cache.py

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å
./scripts/bump_cache.sh --rollback
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Version inconsistency"
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–µ—Ä—Å–∏–∏
./scripts/bump_cache.sh 1.3.111 --no-backup
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Backup not found"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ backup'—ã
ls -la backup_cache_*

# –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ rollback
./scripts/bump_cache.sh 1.3.111
```

## üìà –£–ª—É—á—à–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ç–∞—Ä—ã–º `bump_cache.sh`

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **Inconsistent versions** - –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
2. **Regex issues** - –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ regex patterns –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
3. **Version verification** - –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–∏—Ñ—Ä—ã
4. **Bash variables in Python** - –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å heredoc
5. **Relative paths** - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—É—Ç–µ–π
6. **File type coverage** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤–∫–ª—é—á–∞—è `main.min.css` –∏ SVG
7. **Encoding issues** - –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ UTF-8
8. **No rollback** - –î–æ–±–∞–≤–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–∫–∞—Ç–∞
9. **Error handling** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
10. **Testing** - –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup'—ã
- Rollback —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìù –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- **Python 3.7+** - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- **Bash 4.0+** - Wrapper —Å–∫—Ä–∏–ø—Ç
- **UTF-8** - –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤
- **Unix-like systems** - macOS, Linux

## ü§ù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CI/CD

```yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è GitHub Actions
- name: Update cache version
  run: |
    ./scripts/bump_cache.sh ${{ github.run_number }}
    git add .
    git commit -m "Bump cache to ${{ github.run_number }}"
```

---

**–°–æ–∑–¥–∞–Ω–æ:** –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0.0

